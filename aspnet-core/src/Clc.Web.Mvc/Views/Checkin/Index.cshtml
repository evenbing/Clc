@section Scripts
{
    <environment names="Development">
        <script src="~/js/finput.js" asp-append-version="true"></script>
        <script src="~/js/work.js" asp-append-version="true"></script>
        <script src="~/view-resources/Views/Checkin/index.js" asp-append-version="true"></script>
    </environment>
    <environment names="Staging,Production">
        <script src="~/js/work.min.js" asp-append-version="true"></script>
        <script src="~/js/work.min.js" asp-append-version="true"></script>
        <script src="~/view-resources/Views/Checkin/index.js" asp-append-version="true"></script>
    </environment>

    <script type="text/javascript">
        var allowCardWhenCheckin = true;

        function operator (val, row, index) {
            return '<a href="javascript:void(0)" onclick="scanFinger(' + index + ')">指纹验证</a>';
        }

        function scanFinger(index) {
            var row = $('#dg').datagrid('getRows')[index];
            var finger = window.parent.getFingerCode();
            if (finger != '') {
                abp.services.app.work.checkinByFinger(finger, row.workerId, work.me.today, work.me.depotId, work.me.affairId).done(function(ret) {
                    abp.notify.info(ret.item2);
                    if (ret.item1) 
                        $('#dg').datagrid('reload');
                });
            }
        };

        finput.onWorker = function(rfid) {
            if (!work.validate()) return;
            if (!allowCardWhenCheckin) {
                abp.notify.error('系统设置为不允许刷卡验证');
                return;
            }

            window.parent.displayRfid1(rfid);
            abp.services.app.work.signinByRfid(rfid).done(function(ret) {
                abp.notify.info(ret.item2);
                if (ret.item1) $('#dg').datagrid('reload');
            });
        };

    </script>
}

<div class="easyui-layout" fit="true">
    <div data-options="region:'north', split:true, border:false" style="min-height:120px; height:75%">
		<div class="easyui-layout" fit="true">
    		<div data-options="region:'east', title:'任务概要', collapsed:true, split:true" style="width:280px">
    			<form id="fm" class="easyui-form" method="post" novalidate>
        			<table class="edit-tbl">
            			<tr>
                			<th><label for="workplaceName">工作地点</label></th>
                			<td><input name="workplaceName" class="easyui-textbox" readonly style="width: 100%"></td>
            			</tr>
            			<tr>
                			<th><Label for="startTime">开始时间</Label></th>
                			<td><input name="startTime" class="easyui-textbox" readonly style="width: 100%"></td>
            			</tr>
            			<tr>
                			<th><label for="endTime">结束时间</label></th>
                			<td><input name="endTime" class="easyui-textbox" readonly style="width: 100%"></td>
            			</tr>
                        <tr>
                            <th><label for="isTomorrow">明天结束: </label></th>
                            <td><input name="isTomorrow" class="easyui-switchbutton" readonly data-options="height:24,onText:'是',offText:'否'"></td>
                        </tr>
              			<tr>
                			<th><label for="remark">备注</label></th>
                			<td><input name="remark" class="easyui-textbox" readonly style="width: 100%"></td>
            			</tr>
         			</table>
    			</form>
			</div>
    		<div data-options="region:'center'">
                <div id="tb">
                    任务日期: <input id="dd" class="easyui-datebox" style="width:120px" readonly>
                    <a name="reload" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-reload" plain="true">刷新</a>
                    <a name="askOpen" href="javascript:void(0)" class="easyui-linkbutton" plain="true">申请开门</a>
                </div>
                <table id="dg" class="easyui-datagrid" toolbar="#tb"
                        fit="true" fitColumns="true" rownumbers="true" singleSelect="true" striped="true">
                    <thead>
                        <tr>
                            <th field="workerName" width="80">人员姓名编号</th>
                            <th field="workRoleName" width="80">工作角色</th>
                            <th field="checkoutTime" width="80" formatter="$.timeFormatter">检出时间</th>
                            <th field="lastAskTime" width="80" formatter="$.timeFormatter">最近申请开门时间</th>
                            <th field="checkinTime" width="80" formatter="$.timeFormatter">验入时间</th>
                            <th field="operator" width="60" align="center" formatter="operator">操作</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
    <div data-options="region:'center'">
        <div id="tbTask">
            <a name="askOpenDoorTask" href="javascript:void(0)" class="easyui-linkbutton" plain="true">金库任务申请开门</a>
        </div>
        <table id="dgTask" class="easyui-datagrid" toolbar="#tbTask"
                fit="true" fitColumns="true" rownumbers="true" singleSelect="true" striped="true" sortName="startTime">
            <thead>
                <tr>
                    <th field="workplaceName" width="80">工作地点</th>
                    <th field="startTime" width="80">开始时间</th>
                    <th field="endTime" width="80">结束时间</th>
                    <th field="isTomorrow" width="80">明天结束</th>
                    <th field="workplaceAskDeadline" width="100">最晚申请开门延时(分钟)</th>
                 </tr>
            </thead>
        </table>
    </div>
</div>
